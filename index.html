<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>加須市周辺マップ</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap"
      rel="stylesheet"
    />
    <style>
      html,
      body,
      #map {
        height: 100%;
        margin: 0;
        padding: 0;
        /*touch-action: none;*/
        overscroll-behavior: none;
        font-family: "Noto sans", sans-serif;
      }
      #map {
        height: calc(100vh - 40px); /* フッターの高さ分を引く */
        height: 100vh;
      }
      .leaflet-popup-content-wrapper {
        font-size: 10px;
        padding: 4px;
        max-width: 180px;
        border-radius: 8px;
      }

      .leaflet-popup-content {
        margin: 0;
        padding: 0;
      }
      #filter-controls {
        position: absolute;
        top: 80px;
        left: 10px;
        z-index: 1000;
        background: white;
        padding: 10px;
        border-radius: 8px;
        font-size: 12px;
        max-width: 180px;
        font-family: "Noto Sans";
      }

      /* 開閉ボタン */
      /* 共通設定 */
      #filter-controls {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 12px;
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.15);
        padding: 10px;
        z-index: 1000;
      }

      #filter-controls label {
        display: block;
        margin: 6px 0;
        font-size: 14px;
      }

      /* モバイル */
      @media (max-width: 768px) {
        #filter-controls {
          position: fixed;
          bottom: 10px;
          left: 10px;
          transform: none;
          width: auto;
          max-width: 200px;
          min-width: 160px;
          background: rgba(255, 255, 255, 0.95);
          border-radius: 12px;
          box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
          z-index: 1000;
          padding: 10px;
          max-height: 50vh;
          overflow-y: auto;
          font-size: 13px;
          margin: 4px 0;
        }

        #toggle-filters {
          position: static;
          display: block;
          width: auto;
          font-size: 14px;
          padding: 6px 12px;
          border: none;
          background: #eaeaea;
          border-radius: 8px;
          margin: 0;
          margin-bottom: 8px;
        }

        #filter-controls:not(.open) {
          background: none;
          box-shadow: none;
          padding: 0;
          height: auto;
        }

        #filter-controls:not(.open) label {
          display: none;
        }

        #filter-options {
          display: none;
        }
        #filter-controls.open {
          max-height: 33vh;
          overflow-y: auto;
        }

        #filter-controls.open #filter-options {
          display: block !important;
        }
      }

      /* PC */
      @media (min-width: 769px) {
        #filter-controls {
          position: absolute;
          top: 80px;
          left: 10px;
          max-width: 180px;
        }

        #toggle-filters {
          display: none;
        }

        #filter-options {
          display: block;
        }
      }
      #splash {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-image: url("img_main_dai01.jpg"), url("img_main_cen01.jpg");
        background-position: left center, right center;
        background-repeat: no-repeat, no-repeat;
        background-size: auto, auto;
        background-color: white;
        z-index: 9999;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: noto-sans;
      }

      @media (max-width: 800px) {
        #splash {
          background-image: url("img_main_dai01_blur.png"),
            url("img_main_cen01_blur.png");
          background-position: center top, center bottom;
          background-repeat: no-repeat, no-repeat;
          background-size: 100% 50%, 100% 50%; /* 上下で半分ずつ表示 */
        }
      }

      #filter-controls.open #filter-options {
        display: block;
      }

      #splash {
        text-align: center;
        animation: fadeOut 1s ease 2s forwards; /* 2秒後にフェードアウト */
      }

      @keyframes fadeOut {
        to {
          opacity: 0;
          visibility: hidden;
        }
      }
      .fade-in {
        opacity: 0;
        animation: fadeInOnly 1.5s ease-out 0.5s forwards;
      }

      @keyframes fadeInOnly {
        to {
          opacity: 1;
        }
      }

      .slide-in {
        opacity: 0;
        transform: translateX(-50px);
        animation: slideIn 1s ease-out forwards;
      }

      @keyframes slideIn {
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      .slide-from-left {
        opacity: 0;
        transform: translateX(50px); /* 左に50pxオフセット */
        animation: slideInFromLeft 1s ease-out forwards;
      }

      @keyframes slideInFromLeft {
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .logo-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px; /* 画像間のスペース */
        flex-wrap: wrap;
        margin-bottom: 20px;
      }

      /* スマホ画面では縦並びに切り替え */
      @media (max-width: 600px) {
        .logo-container {
          flex-direction: column;
        }

        .logo-container img {
          width: 200px;
        }
      }
      .leaflet-marker-icon {
        pointer-events: auto;
      }

      .marker-inner {
        display: block;
        width: 32px;
        height: 42px;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        background-color: transparent;
        border-radius: 50%;
        pointer-events: auto;
        /* アニメ関連の削除 */
        animation: none;
        box-shadow: none;
        transition: none;
      }

      #map {
        height: 100vh;
      }

      #copyright-notice {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: white;
        color: #666;
        font-size: 10px;
        text-align: center;
        padding: 4px 6px;
        z-index: 1000;
        box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.1);

        /* 追加で入れるべきスタイル */
        box-sizing: border-box;
        white-space: normal; /* テキストを折り返す */
        overflow-wrap: break-word; /* 長い単語で改行可能にする */
        word-break: break-word; /* 日本語も改行しやすく */
      }
    </style>
  </head>
  <body>
    <div id="splash">
      <div id="splash-content">
        <div class="logo-container">
          <img src="daiichi_logo.png" alt="第一ロゴ" class="slide-in" />
          <img
            src="center_logo.png"
            alt="センターロゴ"
            class="slide-from-left"
          />
        </div>
        <h1 class="fade-in">ようこそ加須市へ</h1>
        <b class="fade-in">Welcome to KAZO City</b>
      </div>
    </div>

    <div id="filter-controls">
      <button id="toggle-filters">フィルター</button>
      <div id="filter-options">
        <label
          ><input type="checkbox" value="restaurant" checked /> 飲食店</label
        >
        <label><input type="checkbox" value="shop" checked /> コンビニ</label>
        <label><input type="checkbox" value="pharmacy" checked /> 薬局</label>
        <label
          ><input type="checkbox" value="laundry" checked /> ランドリー</label
        >
        <label><input type="checkbox" value="market" checked /> スーパー</label>
        <label
          ><input type="checkbox" value="gs" checked /> ガソリンスタンド</label
        >
      </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      // モバイルブラウザのピンチズームを防ぐ
      document.addEventListener("gesturestart", function (e) {
        e.preventDefault();
      });

      const mapWidth = 3510;
      const mapHeight = 2482;

      const map = L.map("map", {
        crs: L.CRS.Simple,
        minZoom: -3,
        maxZoom: 2,
        zoomSnap: 0.1,
        tap: false,
      });

      const markerGroups = {
        restaurant: L.layerGroup().addTo(map),
        shop: L.layerGroup().addTo(map),
        pharmacy: L.layerGroup().addTo(map),
        laundry: L.layerGroup().addTo(map),
        market: L.layerGroup().addTo(map),
        gs: L.layerGroup().addTo(map),
      };

      const bounds = [
        [0, 0],
        [mapHeight, mapWidth],
      ];
      L.imageOverlay("mymap.webp", bounds).addTo(map);
      map.fitBounds(bounds);

      // 複数アイコンの定義
      const restaurantIcon = L.divIcon({
        className: "",
        iconSize: [32, 42],
        iconAnchor: [16, 42],
        popupAnchor: [0, -42],
        html: '<div class="marker-inner" style="background-image: url(restaurant_icon.webp);"></div>',
      });

      const shopIcon = L.divIcon({
        className: "",
        iconSize: [32, 42],
        iconAnchor: [16, 42],
        popupAnchor: [0, -42],
        html: '<div class="marker-inner" style="background-image: url(shop_icon.webp);"></div>',
      });

      const pharmacyIcon = L.divIcon({
        className: "",
        iconSize: [32, 42],
        iconAnchor: [16, 42],
        popupAnchor: [0, -42],
        html: '<div class="marker-inner" style="background-image: url(pharmacy_icon.webp);"></div>',
      });

      const laundryIcon = L.divIcon({
        className: "",
        iconSize: [32, 42],
        iconAnchor: [16, 42],
        popupAnchor: [0, -42],
        html: '<div class="marker-inner" style="background-image: url(laundry_icon.webp);"></div>',
      });

      const marketIcon = L.divIcon({
        className: "",
        iconSize: [32, 42],
        iconAnchor: [16, 42],
        popupAnchor: [0, -42],
        html: '<div class="marker-inner" style="background-image: url(market_icon.webp);"></div>',
      });

      const gsIcon = L.divIcon({
        className: "",
        iconSize: [32, 42],
        iconAnchor: [16, 42],
        popupAnchor: [0, -42],
        html: '<div class="marker-inner" style="background-image: url(gs_icon.webp);"></div>',
      });

      // ✅ お店の配列データ（ここにお店を増やす）
      // {
      //    name: "店名",
      //    x: X座標,
      //    y: Y座標,
      //    type: お店のタイプ(restaurant,shop,laundry,pharmacy)
      //    hours: "営業時間",
      //    parking: "駐車場の有無",
      //    phone: "xxxx-xx-xxxx",
      //    url: "公式サイトのURL",
      //    image: "店の写真のURL"
      //  },

      setTimeout(() => {
        const splash = document.getElementById("splash");
        splash.style.display = "none";
      }, 3000); // 3秒後に非表示

      document
        .querySelectorAll('#filter-controls input[type="checkbox"]')
        .forEach((checkbox) => {
          checkbox.addEventListener("change", () => {
            const type = checkbox.value;
            const group = markerGroups[type];
            if (checkbox.checked) {
              group.addTo(map);
            } else {
              map.removeLayer(group);
            }
          });
        });

      const toggleBtn = document.getElementById("toggle-filters");
      const filterControls = document.getElementById("filter-controls");

      toggleBtn.addEventListener("click", () => {
        filterControls.classList.toggle("open");
      });
    </script>
    <footer id="copyright-notice">
      当サイトに掲載されているコンテンツの無断転載・複製・再配布を禁じます。 ©
      2025 Kazo Daiichi Hotel.
    </footer>
    <script type="module">
      import { addMarkersToMap } from "./shop.js";

      const icons = {
        restaurant: L.divIcon({
          html: '<div class="marker-inner" style="background-image: url(restaurant_icon.webp);"></div>',
          iconSize: [32, 42],
          iconAnchor: [16, 42],
          popupAnchor: [0, -42],
        }),
        shop: L.divIcon({
          html: '<div class="marker-inner" style="background-image: url(shop_icon.webp);"></div>',
          iconSize: [32, 42],
          iconAnchor: [16, 42],
          popupAnchor: [0, -42],
        }),
        laundry: L.divIcon({
          html: '<div class="marker-inner" style="background-image: url(laundry_icon.webp);"></div>',
          iconSize: [32, 42],
          iconAnchor: [16, 42],
          popupAnchor: [0, -42],
        }),
        market: L.divIcon({
          html: '<div class="marker-inner" style="background-image: url(market_icon.webp);"></div>',
          iconSize: [32, 42],
          iconAnchor: [16, 42],
          popupAnchor: [0, -42],
        }),
        gs: L.divIcon({
          html: '<div class="marker-inner" style="background-image: url(gs_icon.webp);"></div>',
          iconSize: [32, 42],
          iconAnchor: [16, 42],
          popupAnchor: [0, -42],
        }),
        pharmacy: L.divIcon({
          html: '<div class="marker-inner" style="background-image: url(pharmacy_icon.webp);"></div>',
          iconSize: [32, 42],
          iconAnchor: [16, 42],
          popupAnchor: [0, -42],
        }),
      };

      addMarkersToMap(map, mapHeight, markerGroups, icons);
    </script>
  </body>
</html>
